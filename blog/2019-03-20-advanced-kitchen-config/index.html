<!doctype html><html><head><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Pagekit"><link rel=canonical href=https://pschaumburg.github.io/blog/2019-03-20-advanced-kitchen-config/><meta http-equiv=content-language content="en-us"><meta property="og:type" content="website"><meta property="og:site_name" content="Patrick Schaumburg"><meta property="og:title" content="Advanced kitchen configuration"><meta property="og:url" content="https://pschaumburg.github.io/blog/2019-03-20-advanced-kitchen-config/"><meta property="og:image" content="https://pschaumburg.github.io/images/"><meta name=twitter:title content="Patrick Schaumburg"><meta name=twitter:url content="https://pschaumburg.github.io/blog/2019-03-20-advanced-kitchen-config/"><meta name=twitter:image content="https://pschaumburg.github.io/images/"><meta name=twitter:card content><title>Advanced kitchen configuration | Blog</title><link rel=alternate href=/blog/feed title="Patrick Schaumburg" type=application/rss+xml><link href=https://pschaumburg.github.io/css/theme.css rel=stylesheet><link href=https://pschaumburg.github.io/css/github.css rel=stylesheet><link href=https://pschaumburg.github.io/css/style.css rel=stylesheet></head></head><body><div class="uk-container uk-container-center"><div class=tm-header><div class="tm-toolbar uk-clearfix uk-hidden-small"><div class=uk-float-right><div class=uk-panel><ul class=uk-subnav><li><a href=https://github.com/pschaumburg class="uk-icon-hover uk-icon-small uk-icon-github" target=_blank></a></li><li><a href=https://www.xing.com/profile/Patrick_Schaumburg2 class="uk-icon-hover uk-icon-small uk-icon-xing" target=_blank></a></li><li><a href=https://www.linkedin.com/in/patrick-schaumburg-600622ab/ class="uk-icon-hover uk-icon-small uk-icon-linkedin" target=_blank></a></li><li><a href=https://www.facebook.com/pschaumburg class="uk-icon-hover uk-icon-small uk-icon-facebook" target=_blank></a></li></ul></div></div></div><nav class=uk-navbar><a class=uk-navbar-brand href=/><img class="tm-logo uk-responsive-height uk-hidden-small" src=https://pschaumburg.github.io/img/logo/pschaumburg_logo.png alt>
<img class="tm-logo-small uk-responsive-height uk-visible-small" src=https://pschaumburg.github.io/img/logo/pschaumburg_logo.png alt></a><div class=uk-hidden-small><ul class=uk-navbar-nav><li><a href=https://pschaumburg.github.io/>Blog</a></li><li><a href=/contact/ title=Contact>Contact</a></li><li><a href=/repositories/ title=Repositories>Repositories</a></li></ul></div><div class="uk-navbar-flip uk-visible-small"><a href=#offcanvas class=uk-navbar-toggle data-uk-offcanvas></a></div></nav></div><div id=content><main id=tm-content class=tm-content><article class=uk-article><div class="tm-article-content uk-position-relative"><div class="tm-article-date uk-text-center"><span class=tm-article-date-day>20</span>
<span class=tm-article-date-month>Mar</span></div><h1 class=uk-article-title><a href=https://pschaumburg.github.io/blog/2019-03-20-advanced-kitchen-config/>Advanced kitchen configuration</a></h1><p class=uk-article-meta>Written by Patrick Schaumburg</p><div class=uk-margin><p>We&rsquo;re always defining kitchen configurations in a single file, but what happens, when we have configuration, which are only interesting for us or sensitive data?</p><h2 id=environment-changes-for-kitchen>Environment changes for kitchen</h2><p>In a cookbook, the main .kitchen.yml file defines the basic configuration of the kitchen environment with suites, the driver, which will be used, and some other things.</p><p>But: What happens, if only you are using a different driver? Lets say kitchen-ec2 for running kitchen against AWS? Will you change the .kitchen.yml file? Will you push those changes into your git?</p><blockquote><p>NO!!! Don&rsquo;t do this!</p></blockquote><h2 id=more-kitchen-configurations-or-what>More kitchen configurations, or what?</h2><p>I know, it&rsquo;s a bit hidden in the documentation, but: have you ever heard about the .kitchen.local.yml or .kitchen.global.yml?</p><p>If not or if you&rsquo;ve already heard about it, but don&rsquo;t know how they&rsquo;re being used or how to work with them in a best practice way, just move on reading. If you&rsquo;re already working with them, you should stop here, as it won&rsquo;t be any news to you.</p><h3 id=general-usage-of-kitchenlocalyml-and-kitchenglobalyml>General usage of .kitchen.local.yml and .kitchen.global.yml</h3><p>Both files are doing the same, what the .kitchen.yml file does. But it&rsquo;s overriding it&rsquo;s content. It is overwriting the specified section like driver, provisioner or suites. The .kitchen.local.yml overrides the .kitchen.yml and the .kitchen.global.yml overrides the local and main file.</p><p>In a mathematical way: .kitchen.yml &lt; .kitchen.local.yml &lt; .kitchen.global.yml</p><h3 id=how-to-use-them-in-a-bit-more-detail>How to use them in a bit more detail</h3><p>Let&rsquo;s assume, our .kitchen.yml file looks like</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml>---
<span style=color:#66d9ef>driver</span>:
  <span style=color:#66d9ef>name</span>: vagrant

<span style=color:#66d9ef>provisioner</span>:
  <span style=color:#66d9ef>name</span>: chef_zero
  <span style=color:#66d9ef>always_update_cookbooks</span>: <span style=color:#66d9ef>true</span>

<span style=color:#66d9ef>verifier</span>:
  <span style=color:#66d9ef>name</span>: inspec

<span style=color:#66d9ef>platforms</span>:
  - <span style=color:#66d9ef>name</span>: ubuntu<span style=color:#ae81ff>-16.04</span>
  - <span style=color:#66d9ef>name</span>: centos<span style=color:#ae81ff>-7</span>

<span style=color:#66d9ef>suites</span>:
  - <span style=color:#66d9ef>name</span>: default
    <span style=color:#66d9ef>run_list</span>:
      - recipe[kitchen_test::default]
    <span style=color:#66d9ef>verifier</span>:
      <span style=color:#66d9ef>inspec_tests</span>:
        - test/integration/default
    <span style=color:#66d9ef>attributes</span>:
</code></pre></div><p>And we want to change the driver name. As mentioned before, we should <em>not</em> change the .kitchen.yml file. So we&rsquo;re creating a .kitchen.local.yml file</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml>---
<span style=color:#66d9ef>driver</span>:
  <span style=color:#66d9ef>name</span>: ec2
</code></pre></div><p>This only overrides the driver section, everything else is still the same.</p><p>Another example: We only want to add ubuntu-18.04 in the platform section</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml>---
<span style=color:#66d9ef>platforms</span>:
  - <span style=color:#66d9ef>name</span>: ubuntu<span style=color:#ae81ff>-16.04</span>
  - <span style=color:#66d9ef>name</span>: ubuntu<span style=color:#ae81ff>-18.04</span>
  - <span style=color:#66d9ef>name</span>: centos<span style=color:#ae81ff>-7</span>
</code></pre></div><p>As you see there is not only ubuntu-18.04 as an additional platform name. We have to add the whole platforms section. Otherwise it would use the defaults, if there is one defined.</p><p>If a section is missing, you can also add this section only to your .kitchen.local.yml.</p><h2 id=a-bit-more-background-informations>A bit more background informations</h2><p>The .kitchen.yml and .kitchen.local.yml file is always in the cookbooks root directory. So be aware of, you don&rsquo;t commit the .kitchen.local.yml file into any repository, as it only contains your own changes, which might not be interesting for other people or could contain sensitive data.</p><p>The .kitchen.global.yml file can be found in the ~/.kitchen/ directory. This file will be searched always, but if it does not exist, you can just ignore it. Normally, the usage of a .kitchen.local.yml file is enough.</p><h2 id=is-it-possible-to-define-different-paths-for-those-files>Is it possible to define different paths for those files?</h2><p>Yes, definately. You can use the following environment variables to change it.</p><pre><code>KITCHEN_GLOBAL_YAML=/path/to/your/global/config.yml
KITCHEN_YAML=/path/to/your/project/.kitchen.yml
KITCHEN_LOCAL_YAML=/path/to/your/local/.kitchen.local.yml
</code></pre><p>Please be aware of changing environment variables. If you forget to change it back, troubleshooting of anything will be quite hard. So the best way is to use the default paths for all files.</p><h2 id=conclusion>Conclusion</h2><ul><li>when overriding any section, we have to copy over the whole part and not only additional things</li><li>add .kitchen.local.yml to your .gitignore</li><li>using environment variables to change paths to kitchen configuration could bring up failures</li></ul></div></div></article></main></div><div id=tm-footer class=tm-footer><div class="uk-panel uk-panel-box"><div class="uk-container uk-container-center"><section class="uk-grid uk-grid-match" data-uk-grid-margin><div class="uk-width-medium-1-1 uk-row-first"><div class=uk-panel><ul class="uk-subnav uk-margin uk-flex uk-flex-center"><li><a href=#>Hannover, Germany</a></li><li><a href=mailto:info@p-schaumburg.de>info@p-schaumburg.de</a></li></ul></div></div></section></div></div></div></div></body></html>